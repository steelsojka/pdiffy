#!/usr/bin/env node

var _ = require("lodash");
var argv = require("optimist")
  .boolean("i")
  .boolean("interface")
  .argv;
var status = require("../lib/console");
var child_process = require("child_process");
var pdiffy = require("../lib/pdiffy");

var uiProcess;

process.env.NODE_ENV = "production"

switch (argv._[0]) {
  case "schedule": scheduleCapture(); break;
  case "combine": combine(); break;
  default: pdiffy.startServer();
}

function combine() {
  // TODO: add combining functions
  console.log("I'm combining");
};

function scheduleCapture() {
  if (argv._.length < 2) {
    console.log(status.warn("WARN") + " Requires at least one argument");
    return;
  }

  /*if (argv.i || argv.interface) {
    startServer();
  }*/

  var captureConfig = require(argv._[1]);

  if (captureConfig.schedule) {
    pdiffy.runSchedule(captureConfig);
  } else if (captureConfig.interval) {
		pdiffy.runInterval(captureConfig);
	} else {
    pdiffy.capture(captureConfig);
  }
}
